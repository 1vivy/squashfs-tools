	SQUASHFS 4.5 - A squashed read-only filesystem for Linux

	Copyright 2002-2021 Phillip Lougher <phillip@squashfs.org.uk>

	Released under the GPL licence (version 2 or later).

Welcome to Squashfs 4.5.  The last release was just over 1 and half years
ago, and there are substantial improvements to the tools in this release.

Please see the INSTALL file for instructions on installing the tools,
and the USAGE file for documentation on how to use the tools.

Summary of changes (and sections below)
---------------------------------------

1. Major improvements in Mksquashfs
------------------------------------

1.1 Mksquashfs now supports "Actions". These are modelled on "find"
    and allow compression, fragment packing, file exclusion and
    file attributes to be changed on a per-file basis.

1.2 Tar style handling of source pathnames in Mksquashfs.  If option is
    specified, Mksquashfs will not strip leading directories.

1.3 Symbolic links are now followed in exclude files.

1.4 New option to throttle the amount of CPU and I/O Mksquashfs uses.

1.5 New Pseudo file definitions which support timestamps.

1.6 New Pseduo file definitions to create Hard Links and Sockets/Fifos.

1.7 New Pseudo file "R" definition which allows a Regular file to
    be created with data stored within the Pseudo file (see 2.3 below).


2. Major improvements in Unsquashfs
-----------------------------------

2.1 New Sqfscat command which will output the contents of one or
    more files to standard out (Unsquashfs called as sqfscat, also
    Unsquashfs -cat option).

2.2 Unsquashfs now supports "exclude" files in addition to "extract"
    files.

2.3 Max depth traversal option added (-max-depth).

2.4 Unsquashfs can now output a "Pseudo file" representing the
    input Squashfs filesystem.  This can be altered and given
    as input to Mksquashfs to re-generate the filesystem without
    unpacking it.


3. Minor improvements and bug fixes
-----------------------------------

3.1 New -no-hardlinks option in Mksquashfs, which makes
    Mksquashfs treat hardlinked files as duplicates instead.

3.2 Mksquashfs now allows no source directory ( specified as - )
    to be specified, with all input from pseudo file definitions.

3.3 New -help options in Mksquashfs and Unsquashfs which output
    to standard out, rather than standard error.

3.4 -no-exit-code option added to Unsquashfs which makes it
    not output an error exit code.

3.5 Exit code in Unsquashfs changed to distinguish between
    non-fatal errors (exit of 2), and fatal errors
    (exit code of 1).

3.6 Xattr id count added in Unsquashfs "-stat" output.

3.7 Unsquashfs "write outside directory" exploit fixed.

3.8 Error handling in Unsquashfs writer thread fixed.


4. Mksquashfs Actions Introduction
----------------------------------

The new Mksquashfs Actions code allows an "action" to be executed
on a file if one or more "tests" succeed.  If you're familiar
with the "find" command, then an action is similar to "-print",
and a test is similar to say "-name" or "-type".

At this point it is useful to give two concrete examples.

example 1: the fragment action

% mksquashfs /home/phillip/github github.sqsh -action "fragment(cfiles) @ name(*.[ch])" -action "fragment(ofiles) @ name(*.o)"

This example defines two "fragment actions" which control the packing
of files within fragments.  Specifically, it creates a specialised fragment
called "cfiles" which packs files matching the wildcard name "*.[ch]".

It also creates another specialised fragment called "ofiles" which packs
files matching the wilcard name "*.o".

Producing specialised fragments which only pack files which match a range
of tests, can produce better compression and/or I/O performance as
it can optimise similarity or access patterns.  But it can also
produce worse compression, and so you should always test
the effect.

Additionally, you should be able to see that an action definition is split
into an action function before the "@", and one or more test functions
after the @.  Quoting is necessary here to protect it from interpretation
by the shell.  Also the spacing before and after the "@" isn't necessary
and is used here for added readability.

example 2: the uncompressed action

% mksquashfs /home/phillip backup.sqsh -action "uncompressed @ ( name(*.jpg) || name(*.mpg) ) || ( name(*.img) && filesize(+1G) )"

This is a more complex example.  It tells Mksquashfs to not try and
compress any file which matches the wildcard names "*.jpg" and "*.mpg".
But it also tells Mksquashfs not to try and compress files which match
the wildcard name "*.img" and are also 1 Gigabyte in size or larger.

This example introduces the fact that tests can be combined using
the logical operators && (and), || (or) and ! (not), and can be
bracketed.

?. Compatiblity
---------------

Mksquashfs 4.4 generates 4.0 filesystems.  These filesystems are fully
compatible/interchangable with filesystems generated by Mksquashfs 4.x and are
mountable on 2.6.29 and later kernels.
